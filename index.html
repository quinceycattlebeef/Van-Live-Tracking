<script>
  const map = L.map('map').setView([27.5, -83.5], 6); // Zoomed to Florida
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Map data Â© OpenStreetMap contributors'
  }).addTo(map);

  let liveLayer = null;

  async function fetchVanLocation() {
    try {
      const response = await fetch("https://polished-water-fc63.huntersharp-qcc.workers.dev/");
      const data = await response.json();
      const lat = data.latitude;
      const lon = data.longitude;

      const geojsonFeature = {
        type: "Feature",
        geometry: {
          type: "Point",
          coordinates: [lon, lat]
        },
        properties: {
          title: data.label || "Reefer Van"
        }
      };

      if (liveLayer) {
        map.removeLayer(liveLayer);
      }

      liveLayer = L.geoJSON(geojsonFeature, {
        onEachFeature: function (feature, layer) {
          layer.bindPopup(feature.properties.title).openPopup();
        }
      }).addTo(map);

      map.setView([lat, lon]); // Optional: auto-follow

    } catch (error) {
      console.error("ðŸš¨ Error fetching van location:", error);
    }
  }

  fetchVanLocation(); // Load first time
  setInterval(fetchVanLocation, 10000); // Refresh every 10 sec
</script>
